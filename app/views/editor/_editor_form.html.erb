<div id="editor_app">
<div id="loading_overlay"></div>
<%= render :partial => 'shared/modal', :locals => {:id => "file_load_modal", :title => "Your file is being loaded", :message => "Depending on the file size, this can be long."} %>
<%= render :partial => 'shared/modal', :locals => {:id => "app_load_modal", :title => "The application is being loaded", :message => ""} %>
<%= render :partial => 'shared/modal', :locals => {:id => "clearance_wait_modal", :title => "Waiting for your preferences to be saved.", :message => "This should take a few seconds. You can skip this step if you're too impatient.", :buttons => {'skip_clearance' => "Skip"}} %>
<%= render :partial => 'shared/modal', :locals => {:id => "auth_failed_modal", :title => "The authentication failed with Google", :message => "You need to enable the popups in your browser, then login in your Google account and accept the app's authorization requests.", :with_bar => false, :buttons => {'restart_app' => 'Restart app'}} %>
<%= render :partial => 'shared/modal', :locals => {:id => "error_modal", :title => "An unexpected error occured with Google's server", :message => "The app flow will still continue but unexpected behavior may occur. When in doubt restart the app.", :with_bar => false, :dismiss => true} %>
<%= render 'file_info' %>
<%= render :partial => 'major_notice_modal' %>
<%= render :partial => 'terms' %>
<%= render :partial => 'flash' %>

<div id="print_content" style="display:none">
  <%= render :partial => 'print' %>
</div>

<script>
   $("#app_load_modal").modal({'show':true,backdrop: true,backdrop: 'static', keyboard:false});
   $('.modal-backdrop.fade.in').css('opacity', '1.0')
</script>

<div id="editor_menu_container" >
  <div id="editor_menu" class="g_file_menu" >

    <%= render 'editor_menu' %>

    <div id="editor_flash">
      <%= render 'shared/flash', :flash => flash %>
    </div>
    
    <div class="g_file_editor_file_explorer">
      <%= render 'shared/file_explorer', :with_dropdown => true %>
    </div>

    <%= render 'shared/editor_message' %>

  </div>

</div>

<div class="g_file_editor">
  <div id="editor"></div>
</div>
    
<%= render 'shared/user' %>

</div>
<script type="text/javascript">

var oauth_controller = new OAuthController({
  scopes : "<%= @gapi.get_scopes.join(' ') %>" 
});

var user_preferences
var editor_controller
oauth_controller.add_to_queue(function(){
  user_preferences = new Preferences(
    function(){
      editor_controller = new EditorController("editor_app", {
        'word_wrap_pref':Preference.find('word_wrap', BooleanPreference),
        'font_size_pref': Preference.find('ace_js_font_size', StringPreference),
        'tab_size_pref' : Preference.find('ace_js_tab_size', StringPreference),
        'major_notice_pref' : Preference.find('major_notice', IntPreference),
        'theme_pref': Preference.find('theme', StringPreference),
        'menu_width_pref' : Preference.find('menu_width', StringPreference),
        'keybinding_pref' : Preference.find('keybinding', StringPreference),
        'flash' : new FlashController('editor_flash'),
        'file_explorer': new FileExplorerController("file_explorer_container", {
          'height_pref' : Preference.find('file_explorer_height', StringPreference),
          }),
        })
      editor_controller.file_explorer.parent = editor_controller 
      editor_controller.file_explorer.flash = editor_controller.flash
      editor_controller.oauth_controller = oauth_controller;
      editor_controller.file_explorer.load();

      new EditorRouter(editor_controller)

    }
  )
})

var menu_controller = new MenuController("menu");



//editor_controller.initialize_html() 

</script>
